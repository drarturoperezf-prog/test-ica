<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Test ICA ¬∑ Riesgo cardiometab√≥lico</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root{
      --bg:#f5f7fb;
      --text:#0f172a;
      --muted:#475569;
      --card:#ffffff;
      --border:#e2e8f0;
      --green:#22c55e;
      --amber:#f59e0b;
      --red:#ef4444;
      --shadow: 0 14px 30px rgba(2,6,23,.08);
    }
    body{
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
    }
    .screen{display:none;padding:24px;max-width:520px;margin:0 auto;min-height:100vh;align-content:center}
    .screen.active{display:block}
    .card{background:#fff;border:1px solid var(--border);border-radius:18px;padding:20px;box-shadow:var(--shadow)}
    h1{font-size:34px;line-height:1.08;margin:0 0 14px}
    p{font-size:16px;color:var(--muted)}
    .small{font-size:14px;color:#64748b}
    input{width:100%;padding:14px;font-size:18px;border-radius:12px;border:1px solid var(--border);margin-top:14px}
    .btn{width:100%;margin-top:18px;padding:16px;font-size:18px;font-weight:800;border-radius:14px;border:0;cursor:pointer}
    .btn.primary{background:linear-gradient(135deg,#111827,#334155);color:#fff}
    .btn.secondary{background:#fff;border:1px solid var(--border)}
    .error{margin-top:12px;color:#b91c1c;font-weight:700;display:none}
    .result{margin-top:14px;padding:18px;border-radius:16px;border:1px solid var(--border)}
    .result.low{background:#ecfdf3;border-left:7px solid var(--green)}
    .result.moderate{background:#fffbeb;border-left:7px solid var(--amber)}
    .result.high{background:#fef2f2;border-left:7px solid var(--red)}
    .ica-pill{margin:10px 0;font-weight:800}
  </style>
</head>

<body>

<div class="screen active" id="s1">
  <div class="card">
    <h1>¬øTu grasa abdominal est√° poniendo en riesgo tu salud?</h1>
    <p>Test r√°pido basado en el √≠ndice cintura-altura.</p>
    <div class="small">‚è± 2 minutos ¬∑ No es diagn√≥stico m√©dico</div>
    <button class="btn primary" onclick="go(2)">Empezar el test</button>
  </div>
</div>

<div class="screen" id="s2">
  <div class="card">
    <h1>¬øPer√≠metro de cintura? (cm)</h1>
    <input id="cintura" type="number" />
    <div class="error" id="err2">Valor inv√°lido</div>
    <button class="btn primary" onclick="nextCintura()">Siguiente</button>
  </div>
</div>

<div class="screen" id="s3">
  <div class="card">
    <h1>¬øAltura? (cm)</h1>
    <input id="altura" type="number" />
    <div class="error" id="err3">Valor inv√°lido</div>
    <button class="btn primary" onclick="nextAltura()">Siguiente</button>
  </div>
</div>

<div class="screen" id="s4">
  <div class="card">
    <h1>¬øTe cuesta perder grasa abdominal?</h1>
    <button class="btn primary" onclick="answer(1)">S√≠</button>
    <button class="btn secondary" onclick="answer(0)">No</button>
  </div>
</div>

<div class="screen" id="s5">
  <div class="card">
    <h1>¬øHas recuperado peso tras perderlo?</h1>
    <button class="btn primary" onclick="answer(1)">S√≠</button>
    <button class="btn secondary" onclick="answer(0)">No</button>
  </div>
</div>

<div class="screen" id="s6">
  <div class="card">
    <h1>¬øTensi√≥n, az√∫car o colesterol altos?</h1>
    <button class="btn primary" onclick="answer(1)">S√≠</button>
    <button class="btn secondary" onclick="answer(0)">No</button>
  </div>
</div>

<div class="screen" id="s7">
  <div class="card">
    <h1>Antes de ver tu resultado</h1>
    <input id="leadNombre" placeholder="Nombre" />
    <input id="leadEmail" placeholder="Email" />
    <input id="leadTel" placeholder="Tel√©fono" />
    <div class="error" id="err7">Datos incorrectos</div>
    <button class="btn primary" onclick="submitLeadsAndResult()">Ver resultado</button>
  </div>
</div>

<div class="screen" id="s8">
  <div class="card">
    <h1 id="resultTitle"></h1>
    <div class="ica-pill">ICA: <span id="icaValue"></span></div>
    <div class="result" id="resultBox">
      <p id="resultText"></p>
    </div>
    <a class="btn primary" href="https://www.instagram.com/dr.arturoperezf/" target="_blank">Escribirme por Instagram</a>
  </div>
</div>

<script>
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycby2-U6fvjNmw7ojHatAQUSVuidKX5TcAN0ivozgIN5MD3w_YnJnQxFcHlP2l9Jh-4B62Q/exec";

let clinicalScore = 0;

function go(n){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById('s'+n).classList.add('active');
}

function nextCintura(){
  const v = +cintura.value;
  if(v>50 && v<200) go(3); else err2.style.display='block';
}

function nextAltura(){
  const v = +altura.value;
  if(v>120 && v<230) go(4); else err3.style.display='block';
}

function answer(v){
  clinicalScore+=v;
  go(clinicalScore<3?clinicalScore+4:7);
}

function submitLeadsAndResult(){
  const nombre=leadNombre.value.trim();
  const email=leadEmail.value.trim();
  const tel=leadTel.value.trim();
  if(nombre.length<2||!email.includes('@')||tel.length<7){err7.style.display='block';return}

  const cinturaV=+cintura.value, alturaV=+altura.value;
  const ica=(cinturaV/alturaV).toFixed(2);
  let riesgo=ica<0.5&&clinicalScore===0?"low":ica<0.6||clinicalScore<=1?"moderate":"high";

  fetch(WEBAPP_URL,{
    method:"POST",
    mode:"no-cors",
    headers:{'Content-Type':'application/x-www-form-urlencoded'},
    body:new URLSearchParams({nombre,email,telefono:tel,ica,riesgo})
  });

  resultTitle.innerText =
    riesgo==="low"?"üü¢ Riesgo bajo":
    riesgo==="moderate"?"üü† Alerta metab√≥lica":
    "üî¥ Riesgo elevado";

  resultText.innerText = riesgo;
  icaValue.innerText = ica;
  resultBox.className="result "+riesgo;
  go(8);
}
</script>

</body>
</html>
